{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Modificar Reserva</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

<div class="container-fluid px-3 px-sm-5 my-5 contenedor-reserva">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <form method="POST" class="formulario-reserva border rounded p-4 bg-light shadow-sm">
        {% csrf_token %}
        <h4 class="text-center mt-5 mb-4">Modificar Reserva</h4>

        <!-- Nombre  -->
        <div class="mb-3">
          <label for="nombre_cliente" class="form-label">Nombre completo</label>
          <input type="text" class="form-control" id="nombre_cliente" name="nombre_cliente"
                 value="{{ request.session.usuario_nombre }}" readonly>
        </div>

        <!-- Correo  -->
        <div class="mb-3">
          <label for="correo" class="form-label">Correo electrónico</label>
          <input type="email" class="form-control" id="correo" name="correo"
                 value="{{ request.session.usuario_correo }}" readonly>
        </div>

        <!-- Fechas -->
        <div class="row">
          <div class="col-md-6 mb-3">
            {{ form.fecha_inicio.label_tag }}
            {{ form.fecha_inicio }}
          </div>
          <div class="col-md-6 mb-3">
            {{ form.fecha_fin.label_tag }}
            {{ form.fecha_fin }}
          </div>
        </div>

        <!-- Resultados -->
        <div class="alert alert-info mt-3" id="resumen" style="display: none;">
          <p><strong>Días a reservar:</strong> <span id="dias"></span></p>
          <p><strong>Total a pagar:</strong> $<span id="total"></span> CLP</p>
        </div>

        <!-- Botones -->
        <div class="d-flex justify-content-between mt-3">
          <button type="submit" class="btn btn-success">Guardar Cambios</button>
          <a href="{% url 'mi_perfil' %}" class="btn btn-secondary">Cancelar</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const fechaInicio = document.getElementById('id_fecha_inicio');
    const fechaFin = document.getElementById('id_fecha_fin');
    const resumen = document.getElementById('resumen');
    const diasSpan = document.getElementById('dias');
    const totalSpan = document.getElementById('total');
    const precioPorDia = parseInt("{{ precio_dia|default_if_none:'0'|safe }}");
    console.log("Precio por día:", precioPorDia);

    function calcularResumen() {
      const inicio = new Date(fechaInicio.value);
      const fin = new Date(fechaFin.value);
      if (!isNaN(inicio) && !isNaN(fin) && fin > inicio) {
        const dias = Math.ceil((fin - inicio) / (1000 * 60 * 60 * 24));
        diasSpan.textContent = dias;
        totalSpan.textContent = dias * precioPorDia;
        resumen.style.display = 'block';
      } else {
        resumen.style.display = 'none';
      }
    }

    fechaInicio.addEventListener('change', calcularResumen);
    fechaFin.addEventListener('change', calcularResumen);

    calcularResumen();  // Mostrar resumen inicial
  });
</script>

</body>
</html>